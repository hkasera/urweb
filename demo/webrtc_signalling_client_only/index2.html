<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Testing PeerJs</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="custom.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>

<div class="container">
    <div>
        <p>Create Offer / Create Answer</p>
        <button id="createOffer">Create Offer</button>
        <textarea name="offer" id="offer" cols="30" rows="10"></textarea>
        <button id="consumeOffer">Create Answer</button>
    </div>
    <hr>
    <div>
        <p>Consume Offer and Create Answer</p>
        <textarea name="answer" id="answer" cols="30" rows="10"></textarea>
        <button id="consumeAnswer">Consume Answer</button>
    </div>
    <hr>
    <div>
        <p>Generated Ice Candidate</p>
        <textarea name="ice-candidate" id="ice-candidate" cols="30" rows="10"></textarea>
    </div>
    <hr>
    <div>
        <p>Consume Ice Candidate</p>
        <textarea name="ice-candidate-recv" id="ice-candidate-recv" cols="30" rows="10"></textarea>
        <button id="consumeIceCandidate">Consume Ice Candidate</button>
    </div>
</div>
<script>
    $(function () {
        var pc = window.pc = createRTCPeerConnection();
        pc.onicecandidate = function (event) {
            console.log("Ice Candiate event called");
            if (event.candidate) {
                console.log("Outgoing ICE candidate: " + event.candidate.candidate);

                // sendToServer({
                //     type: "new-ice-candidate",
                //     target: targetUsername,
                //     candidate: event.candidate
                // });
                console.log(event.candidate);
                var str = $("#ice-candidate").text() + "\n\n\n\n" + JSON.stringify(event.candidate);
                $("#ice-candidate").text(str);
            }
        };

        $("#createOffer").click(function () {
            var promise = _createOffer(pc, 456);
            promise.then(function (obj) {
                $("#offer").text(JSON.stringify(obj));
            });
        });

        $("#consumeOffer").click(function () {
            var obj = JSON.parse($("#offer").val());
            var promise = _handleOffer(pc, obj);
            promise.then(function (answer) {
                $("#answer").text(JSON.stringify(answer));
            })
        });

        $("#consumeAnswer").click(function () {
            var obj = JSON.parse($("#answer").val());
            _handleAnswer(pc, obj);
        });

        $("#consumeIceCandidate").click(function () {
            var str = $("#ice-candidate-recv").val();
            var arr = str.split("\n\n\n\n");
            arr.forEach(function (x) {
                if (x.length) {
                    var obj = JSON.parse(x);
                    _consumeNewICECandidateMsg(pc, obj);
                }
            });
        })
    });
</script>
</body>
</html>
